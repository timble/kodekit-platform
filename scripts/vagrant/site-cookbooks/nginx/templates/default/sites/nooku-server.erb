server {
  listen   80;
  server_name  localhost;

  root   <%= node['nginx']['nooku-server']['site_dir'] %>/public;
  index  index.php index.html index.htm;

  access_log  /var/log/nginx/<%= node['nginx']['nooku-server']['site_name'] %>.access.log;
  error_log   /var/log/nginx/<%= node['nginx']['nooku-server']['site_name'] %>.error.log;

  location = /favicon.ico {
    log_not_found off;
    access_log off;
  }

  location / {
    try_files $uri @rewrite;
  }

  location @rewrite {
    if (!-e $request_filename) {
      rewrite ^/administrator/(.*)$ /administrator/index.php?$1 last;
      rewrite ^/(.*)$ /index.php?$1 last;
    }
  }

  location ~ \.php$ {
    try_files $uri = 404;

    fastcgi_pass   127.0.0.1:9000;
    fastcgi_index  index.php;
    fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;

    include fastcgi_params;
  }
}